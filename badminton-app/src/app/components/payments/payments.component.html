<div class="payments px-4">
    <div class="page-header animate-fade-in">
        <div>
            <h1>ğŸ’³ Payments</h1>
            <p>Track dues, collections, and financial overview</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline">ğŸ“¤ Export</button>
            <button class="btn btn-primary animate-scale-in" (click)="openModal()">+ Record Payment</button>
        </div>
    </div>

    <!-- Finance Summary -->
    <div class="grid-4 mb-24 animate-stagger">
        <div class="stat-card green">
            <div class="stat-icon green">ğŸ’°</div>
            <div class="stat-info">
                <div class="stat-value">â‚¹{{ totalCollected | number }}</div>
                <div class="stat-label">Total Collected</div>
                <div class="stat-change up">This Month</div>
            </div>
        </div>
        <div class="stat-card orange">
            <div class="stat-icon orange">â³</div>
            <div class="stat-info">
                <div class="stat-value">â‚¹{{ totalPending | number }}</div>
                <div class="stat-label">Pending</div>
                <div class="stat-change down">{{ pendingCount }} Players</div>
            </div>
        </div>
        <div class="stat-card blue">
            <div class="stat-icon blue">ğŸ§¾</div>
            <div class="stat-info">
                <div class="stat-value">{{ payments.length }}</div>
                <div class="stat-label">Transactions</div>
                <div class="stat-change up">This Month</div>
            </div>
        </div>
        <div class="stat-card purple">
            <div class="stat-icon purple">ğŸ“ˆ</div>
            <div class="stat-info">
                <div class="stat-value">{{ collectionRate }}%</div>
                <div class="stat-label">Collection Rate</div>
                <div class="stat-change up">â†‘ 5% vs last month</div>
            </div>
        </div>
    </div>

    <!-- Payment Table -->
    <div class="card">
        <div class="card-header">
            <h3>ğŸ’³ All Transactions</h3>
            <div class="table-actions">
                <select class="filter-select" [(ngModel)]="statusFilter" (change)="filterPayments()">
                    <option value="">All Status</option>
                    <option value="Paid">Paid</option>
                    <option value="Pending">Pending</option>
                    <option value="Overdue">Overdue</option>
                </select>
            </div>
        </div>
        <table class="data-table" *ngIf="filteredPayments.length > 0">
            <thead>
                <tr>
                    <th>Ref #</th>
                    <th>Player</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Method</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody class="animate-stagger">
                <tr *ngFor="let p of filteredPayments">
                    <td><span class="ref-id">{{ p.reference !== '-' ? p.reference : 'â€”' }}</span></td>
                    <td>
                        <div class="player-name-cell">
                            <div class="mini-avatar">{{ getInitials(p.player) }}</div>
                            {{ p.player }}
                        </div>
                    </td>
                    <td><span class="type-tag">{{ p.type }}</span></td>
                    <td><span class="amount-cell" [class.paid-amount]="p.status === 'Paid'">â‚¹{{ p.amount | number
                            }}</span></td>
                    <td>
                        <span class="method-tag" *ngIf="p.method !== '-'">{{ getMethodIcon(p.method) }} {{ p.method
                            }}</span>
                        <span class="text-muted" *ngIf="p.method === '-'">â€”</span>
                    </td>
                    <td><span class="date-text">{{ p.date | date:'dd MMM yyyy' }}</span></td>
                    <td>
                        <span class="badge" [ngClass]="getStatusClass(p.status)">
                            {{ getStatusIcon(p.status) }} {{ p.status }}
                        </span>
                    </td>
                    <td>
                        <div class="row-actions">
                            <button class="btn btn-sm btn-primary" *ngIf="p.status !== 'Paid'"
                                (click)="markPaid(p)">Mark Paid</button>
                            <button class="btn btn-sm btn-outline" *ngIf="p.status === 'Paid'">Receipt</button>
                            <button class="action-btn-icon danger" (click)="deletePayment(p.id)"
                                title="Delete">ğŸ—‘ï¸</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <app-loading-state *ngIf="filteredPayments.length === 0" [isLoading]="isLoading" emptyIcon="ğŸ’³"
            emptyTitle="No payments found" emptyMessage="Try adjusting your filters or record a new transaction.">
        </app-loading-state>
    </div>
</div>

<!-- â•â•â• RECORD PAYMENT MODAL â•â•â• -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal modal-lg" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title-wrap">
                <span class="modal-icon">ğŸ’³</span>
                <div>
                    <h3>{{ editMode ? 'Edit Payment' : 'Record New Payment' }}</h3>
                    <p class="modal-subtitle">{{ editMode ? 'Update payment details' : 'Add a payment transaction to the
                        system' }}</p>
                </div>
            </div>
            <button class="close-btn" (click)="closeModal()">âœ•</button>
        </div>

        <div class="modal-body">
            <!-- Amount Hero -->
            <div class="amount-hero">
                <div class="amount-hero-label">AMOUNT</div>
                <div class="amount-input-wrap">
                    <span class="currency-symbol">â‚¹</span>
                    <input type="number" class="amount-input" [(ngModel)]="newPayment.amount" placeholder="0.00" min="0"
                        step="0.01">
                </div>
                <div class="amount-hint">Enter the payment amount in Indian Rupees</div>
            </div>

            <div class="form-section-title">Payment Details</div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Player *</label>
                    <select [(ngModel)]="newPayment.player">
                        <option value="">Select Player</option>
                        <option *ngFor="let p of playerNames" [value]="p">{{ p }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Payment Type *</label>
                    <select [(ngModel)]="newPayment.type">
                        <option value="">Select Type</option>
                        <option value="Monthly Fee">Monthly Fee</option>
                        <option value="Session Fee">Session Fee</option>
                        <option value="Tournament Fee">Tournament Fee</option>
                        <option value="Registration Fee">Registration Fee</option>
                        <option value="Equipment">Equipment</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select [(ngModel)]="newPayment.method">
                        <option value="UPI">ğŸ“± UPI</option>
                        <option value="Card">ğŸ’³ Card</option>
                        <option value="Cash">ğŸ’µ Cash</option>
                        <option value="Bank Transfer">ğŸ¦ Bank Transfer</option>
                        <option value="Cheque">ğŸ“„ Cheque</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Payment Date</label>
                    <input type="date" [(ngModel)]="newPayment.date">
                </div>
            </div>

            <div class="form-section-title">Status</div>
            <div class="status-pills">
                <button type="button" class="status-pill paid" [class.active]="newPayment.status === 'Paid'"
                    (click)="newPayment.status = 'Paid'">
                    <span class="pill-dot"></span>
                    <span class="pill-icon">âœ…</span>
                    <span class="pill-label">Paid</span>
                    <span class="pill-check" *ngIf="newPayment.status === 'Paid'">âœ“</span>
                </button>
                <button type="button" class="status-pill pending" [class.active]="newPayment.status === 'Pending'"
                    (click)="newPayment.status = 'Pending'">
                    <span class="pill-dot"></span>
                    <span class="pill-icon">â³</span>
                    <span class="pill-label">Pending</span>
                    <span class="pill-check" *ngIf="newPayment.status === 'Pending'">âœ“</span>
                </button>
                <button type="button" class="status-pill overdue" [class.active]="newPayment.status === 'Overdue'"
                    (click)="newPayment.status = 'Overdue'">
                    <span class="pill-dot"></span>
                    <span class="pill-icon">ğŸš¨</span>
                    <span class="pill-label">Overdue</span>
                    <span class="pill-check" *ngIf="newPayment.status === 'Overdue'">âœ“</span>
                </button>
            </div>

            <div class="form-group" style="margin-top:14px">
                <label>Reference / Notes</label>
                <input type="text" [(ngModel)]="newPayment.reference" placeholder="e.g. TXN001234 or any note">
            </div>

            <div class="form-error" *ngIf="formError">âš ï¸ {{ formError }}</div>
        </div><!-- /.modal-body -->
        <div class="modal-footer">
            <button class="btn btn-outline" (click)="closeModal()">Cancel</button>
            <button class="btn btn-primary" (click)="savePayment()">
                {{ editMode ? 'ğŸ’¾ Save Changes' : 'âœ… Record Payment' }}
            </button>
        </div>
    </div>
</div>