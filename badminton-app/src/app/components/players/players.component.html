<div class="players px-4">
    <div class="page-header animate-fade-in">
        <div>
            <h1>ğŸ‘¥ Players</h1>
            <p>Manage all {{ players.length }} registered club members</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline">ğŸ“¤ Export</button>
            <button class="btn btn-primary animate-scale-in" (click)="openModal()">+ Add Player</button>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-bar animate-fade-in" style="animation-delay: 0.1s">
        <div class="search-pill">
            <span>ğŸ”</span>
            <input type="text" placeholder="Search players..." [(ngModel)]="searchQuery" (input)="filterPlayers()">
        </div>
        <div class="filter-group">
            <button class="filter-btn" [class.active]="levelFilter === ''" (click)="setFilter('')">All</button>
            <button class="filter-btn" [class.active]="levelFilter === 'Advanced'"
                (click)="setFilter('Advanced')">Advanced</button>
            <button class="filter-btn" [class.active]="levelFilter === 'Intermediate'"
                (click)="setFilter('Intermediate')">Intermediate</button>
            <button class="filter-btn" [class.active]="levelFilter === 'Beginner'"
                (click)="setFilter('Beginner')">Beginner</button>
        </div>
    </div>

    <!-- Players Grid -->
    <div class="players-grid animate-stagger" *ngIf="filteredPlayers.length > 0">
        <div class="player-card" *ngFor="let p of filteredPlayers; let i = index">
            <div class="player-card-header">
                <div class="player-avatar" [style.background]="getColor(i)">
                    <img *ngIf="p.image" [src]="p.image" alt="Avatar" class="avatar-img">
                    <span *ngIf="!p.image">{{ p.avatar }}</span>
                </div>
                <div class="player-meta">
                    <h3>{{ p.name }}</h3>
                    <p class="player-email">{{ p.email }}</p>
                    <span class="badge" [ngClass]="p.status === 'Active' ? 'badge-success' : 'badge-warning'">{{
                        p.status }}</span>
                </div>
                <div class="card-actions">
                    <button class="action-btn" title="Edit" (click)="openEditModal(p)">âœï¸</button>
                    <button class="action-btn danger" title="Delete" (click)="deletePlayer(p.id)">ğŸ—‘ï¸</button>
                </div>
            </div>
            <div class="player-stats">
                <div class="pstat"><span class="pstat-val">{{ p.wins }}</span><span class="pstat-label">Wins</span>
                </div>
                <div class="pstat"><span class="pstat-val">{{ p.losses }}</span><span class="pstat-label">Losses</span>
                </div>
                <div class="pstat"><span class="pstat-val">{{ p.points }}</span><span class="pstat-label">Points</span>
                </div>
                <div class="pstat"><span class="pstat-val">{{ getWinRate(p) }}%</span><span class="pstat-label">Win
                        Rate</span></div>
            </div>
            <div class="player-quick">
                <span class="quick-info">ğŸ“ {{ p.phone }}</span>
                <span class="quick-info">ğŸ¸ {{ p.matchesPlayed }} matches</span>
            </div>
            <div class="player-footer">
                <span class="level-badge" [ngClass]="getLevelClass(p.level)">{{ getLevelIcon(p.level) }} {{ p.level
                    }}</span>
                <span class="join-date">Joined {{ p.joinDate | date:'MMM y' }}</span>
            </div>
            <div class="win-bar">
                <div class="win-fill" [style.width.%]="getWinRate(p)"></div>
            </div>
        </div>
    </div>
    <div class="empty-state" *ngIf="filteredPlayers.length === 0">
        <div class="empty-icon">ğŸ”</div>
        <h3>No players found</h3>
        <p>Try adjusting your search or filters</p>
    </div>
</div>

<!-- â•â•â• ADD / EDIT PLAYER MODAL â•â•â• -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal modal-lg" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title-wrap">
                <span class="modal-icon">{{ editMode ? 'âœï¸' : 'ğŸ‘¤' }}</span>
                <div>
                    <h3>{{ editMode ? 'Edit Player' : 'Add New Player' }}</h3>
                    <p class="modal-subtitle">{{ editMode ? 'Update player information' : 'Register a new club member'
                        }}</p>
                </div>
            </div>
            <button class="close-btn" (click)="closeModal()">âœ•</button>
        </div>

        <!-- Avatar Preview -->
        <div class="avatar-preview-row">
            <div class="avatar-preview" [style.background]="previewColor">{{ newPlayer.avatar || '?' }}</div>
            <div class="color-picks">
                <span *ngFor="let c of colorOptions; let i = index" class="color-dot" [style.background]="c"
                    [class.selected]="selectedColorIdx === i" (click)="selectColor(i)"></span>
            </div>
        </div>

        <div class="form-section-title">Personal Info</div>
        <div class="grid-2">
            <div class="form-group">
                <label>Full Name *</label>
                <input type="text" [(ngModel)]="newPlayer.name" (input)="updateAvatar()"
                    placeholder="e.g. Arjun Sharma">
                <span class="form-hint">Used for leaderboard & matches</span>
            </div>
            <div class="form-group">
                <label>Email Address *</label>
                <input type="email" [(ngModel)]="newPlayer.email" placeholder="player@example.com">
            </div>
            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" [(ngModel)]="newPlayer.phone" placeholder="+91 9876543210">
            </div>
            <div class="form-group">
                <label>Date of Joining</label>
                <input type="date" [(ngModel)]="newPlayer.joinDate">
            </div>
        </div>

        <div class="form-section-title">Club Details</div>
        <div class="grid-3">
            <div class="form-group">
                <label>Skill Level *</label>
                <select [(ngModel)]="newPlayer.level">
                    <option value="">Select Level</option>
                    <option value="Beginner">ğŸŒ± Beginner</option>
                    <option value="Intermediate">ğŸŒŸ Intermediate</option>
                    <option value="Advanced">âš¡ Advanced</option>
                </select>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select [(ngModel)]="newPlayer.status">
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select>
            </div>
            <div class="form-group">
                <label>Initial Points</label>
                <input type="number" [(ngModel)]="newPlayer.points" placeholder="0" min="0">
            </div>
        </div>
        <div class="form-section-title">Profile Image</div>
        <div class="form-group">
            <label>Upload Profile Picture</label>
            <div class="file-input-wrapper">
                <input type="file" (change)="onFileSelected($event)" accept="image/*">
                <span class="file-hint" *ngIf="selectedFile">Selected: {{ selectedFile.name }}</span>
            </div>
        </div>

        <div *ngIf="editMode">
            <div class="form-section-title">Performance Stats</div>
            <div class="grid-3">
                <div class="form-group">
                    <label>Wins</label>
                    <input type="number" [(ngModel)]="newPlayer.wins" min="0">
                </div>
                <div class="form-group">
                    <label>Losses</label>
                    <input type="number" [(ngModel)]="newPlayer.losses" min="0">
                </div>
                <div class="form-group">
                    <label>Matches Played</label>
                    <input type="number" [(ngModel)]="newPlayer.matchesPlayed" min="0">
                </div>
            </div>
        </div>

        <div class="form-error" *ngIf="formError">âš ï¸ {{ formError }}</div>

        <div class="modal-footer">
            <button class="btn btn-outline" (click)="closeModal()">Cancel</button>
            <button class="btn btn-primary" (click)="savePlayer()">
                {{ editMode ? 'ğŸ’¾ Save Changes' : 'âœ… Add Player' }}
            </button>
        </div>
    </div>
</div>